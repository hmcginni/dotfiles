#!/bin/bash
#
# Move current window to the other display
#
################################################################################


#-------------------------------------------------------------------------------
# Utility Functions

source ~/lib/bash/tiling_functions

function usage()
{
    printf "\tUsage: \n\t  dmove [-h][-a][-w windowID]\n"
}

function err()
{
    printf "\n\tError on line: ${BASH_LINENO[0]}\n"
    usage
}

#-------------------------------------------------------------------------------
# Defaults

desktop=$(getCursorDesktop)
wid=$(gcw)

#-------------------------------------------------------------------------------
# Parse Inputs

while getopts ":hd:" opt; do
    case ${opt} in
	h )
	    echo -e "\tHelp for dmove"
	    usage
	    exit
	    ;;
	a )
	    wid=($(vis))
	    ;;
	w )
	    desktop=$OPTARG
	    ;;
	* )
	    echo -e "\tUnrecognized option"
	    err
	    exit 1
	    ;;
    esac
done
shift $(($OPTIND - 1))

#-------------------------------------------------------------------------------
# Do nothing if there is only one display

if [[ $(desk -n) == 1 ]]; then
    echo -e "\tOnly one desktop detected"
    exit 0
fi

#-------------------------------------------------------------------------------
# Get window locations

for thisWID in "${wid[@]}"; do
    cur=($(geom $thisWID))
    
    move $location $wid
done

#-------------------------------------------------------------------------------
# Find visible windows on specified desktop


res=($(desk -r -d$desktop))
off=($(desk -o -d$desktop))

for thisWID in "${visWIDs[@]}"; do
    corner=($(wmctrl -lG | grep $thisWID | awk '{print $3,$4}'))
    width=$(wmctrl -lG | grep $thisWID | awk '{print $5}')
    wInBound=$(( corner[0] + width > 0 ))
    if (( corner[0] < 0 )); then
    	corner[0]=0
    fi
    xInBound=$(( corner[0] < res[0] + off[0] && corner[0] >= off[0] ))
    yInBound=$(( corner[1] < res[1] + off[1] && corner[1] >= off[1] ))
    if (( $xInBound && $yInBound && $wInBound )); then
	deskVisWIDs+=("$thisWID")
    fi
done

echo "${deskVisWIDs[@]}"


#-------------------------------------------------------------------------------
# END
