#!/bin/bash
#
# RESCALE - Enlarge text on built-in display


#
# Update desktop environment scale factor
#

scale_factor="1"
dconf_text_scale_key="/org/gnome/desktop/interface/text-scaling-factor"
dconf_gui_scale_key="/com/canonical/unity/interface/text-scale-factor"

if [[ $(dpi) -gt 110 ]]
then
    scale_factor=1.15
else
    scale_factor=1
fi

# scale_factor=$(bc -l <<< "sqrt(sqrt( $(dpi) / 96 ))")
dconf write "$dconf_gui_scale_key" "$scale_factor"
sleep 0.1
dconf write "$dconf_text_scale_key" "$scale_factor"



#
# Update Emacs
#

if pgrep emacs >/dev/null
then
	font_string=$(dconf read /org/gnome/desktop/interface/monospace-font-name)
	font=$(echo "${font_string//\'/}" | rev | cut -d" " -f2- | rev)
	font="Input Mono Condensed"
	# emacsclient -e '(hrm/reload-emacs-init-file)'
    emacsclient -e "(hrm/set-scaled-font \"$font\" \"regular\")" >/dev/null
fi

notify-send "rescale" "Scaling text (${scale_factor}x)"
